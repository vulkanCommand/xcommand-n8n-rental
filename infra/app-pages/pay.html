<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>xCommand Cloud — Pricing</title>
<meta name="description" content="Choose your xCommand workspace plan. No subscriptions, no surprises.">
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: hsl(220, 20%, 4%);
    --bg-card: hsl(220, 18%, 7%);
    --fg: hsl(0, 0%, 96%);
    --muted: hsl(220, 10%, 55%);
    --border: hsl(220, 14%, 14%);
    --primary: hsl(180, 70%, 55%);
    --primary-fg: hsl(220, 20%, 4%);
    --secondary: hsl(220, 15%, 12%);
    --surface: hsl(220, 16%, 9%);
    --glow-secondary: hsl(200, 80%, 60%);
    --warn: hsl(38, 95%, 70%);
    --success: hsl(150, 70%, 55%);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    background: var(--bg);
    color: var(--fg);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }

  .grid-bg {
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(var(--border) 1px, transparent 1px),
      linear-gradient(90deg, var(--border) 1px, transparent 1px);
    background-size: 60px 60px;
    opacity: 0.3;
    pointer-events: none;
    z-index: 0;
  }

  /* Header */
  header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 50;
    padding: 0 2rem;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
    background: hsla(220, 20%, 4%, 0.9);
    backdrop-filter: blur(16px);
  }

  .logo {
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: 1.125rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    color: var(--fg);
  }

  .logo span { color: var(--primary); }

  .nav-links {
    display: flex;
    align-items: center;
    gap: 2rem;
  }

  .nav-links a {
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: 0.6875rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    color: var(--muted);
    text-decoration: none;
    transition: color 0.2s;
  }

  .nav-links a:hover { color: var(--fg); }
  .nav-links a.active { color: var(--primary); }

  /* Container */
  .container {
    position: relative;
    z-index: 1;
    max-width: 1120px;
    margin: 0 auto;
    padding: 120px 2rem 100px;
  }

  .section-label {
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: 0.6875rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    color: var(--muted);
    margin-bottom: 1rem;
  }

  h1 {
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 700;
    letter-spacing: -0.02em;
    line-height: 1.1;
    margin-bottom: 1rem;
  }

  .subtitle {
    font-size: 1.125rem;
    color: var(--muted);
    margin-bottom: 3.5rem;
    max-width: 520px;
  }

  /* Pricing Grid */
  .pricing-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1rem;
    max-width: 980px;
  }

  .card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    padding: 2rem;
    display: flex;
    flex-direction: column;
    transition: border-color 0.3s, box-shadow 0.3s, transform 0.18s ease;
    position: relative;
  }

  .card:hover {
    border-color: hsla(180, 70%, 55%, 0.3);
    transform: translateY(-1px);
  }

  .card.popular {
    border-color: hsla(180, 70%, 55%, 0.4);
    box-shadow: 0 0 40px -12px hsla(180, 70%, 55%, 0.15);
  }

  .card.popular::before {
    content: '';
    position: absolute;
    top: -1px;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(to right, transparent, var(--primary), transparent);
  }

  .card-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    justify-content: space-between;
  }

  .card-title {
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: 1.25rem;
    font-weight: 700;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    background: hsla(180, 70%, 55%, 0.1);
    border: 1px solid hsla(180, 70%, 55%, 0.2);
    padding: 0.125rem 0.625rem;
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: 0.625rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--primary);
    white-space: nowrap;
  }

  .badge.soon {
    background: hsla(38, 95%, 70%, 0.08);
    border-color: hsla(38, 95%, 70%, 0.18);
    color: var(--warn);
  }

  .badge.free {
    background: hsla(150, 70%, 55%, 0.08);
    border-color: hsla(150, 70%, 55%, 0.18);
    color: var(--success);
  }

  .price {
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: 2.5rem;
    font-weight: 700;
  }

  .price-meta {
    font-size: 0.875rem;
    color: var(--muted);
    margin-left: 0.5rem;
  }

  .duration {
    font-size: 0.75rem;
    color: var(--muted);
    margin-top: 0.25rem;
    margin-bottom: 1rem;
  }

  .desc {
    font-size: 0.875rem;
    color: var(--muted);
    margin-bottom: 2rem;
    line-height: 1.5;
  }

  .features {
    list-style: none;
    display: grid;
    gap: 0.75rem;
    margin-bottom: 2rem;
    flex: 1;
  }

  .features li {
    display: flex;
    align-items: flex-start;
    gap: 0.625rem;
    font-size: 0.875rem;
    color: hsl(0, 0%, 88%);
  }

  .check-icon {
    width: 14px;
    height: 14px;
    flex-shrink: 0;
    margin-top: 2px;
    color: var(--primary);
  }

  .select-btn {
    width: 100%;
    padding: 0.75rem;
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: 0.8125rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    cursor: pointer;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--fg);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    transition: all 0.25s;
  }

  .select-btn:hover {
    border-color: hsla(180, 70%, 55%, 0.4);
    background: var(--secondary);
  }

  .select-btn.active {
    background: var(--primary);
    border-color: var(--primary);
    color: var(--primary-fg);
    box-shadow: 0 0 20px -5px hsla(180, 70%, 55%, 0.4);
  }

  .select-btn:disabled {
    opacity: 0.55;
    cursor: not-allowed;
  }

  /* Arrow icon */
  .arrow-icon {
    width: 14px;
    height: 14px;
    transition: transform 0.2s;
  }

  .select-btn:hover .arrow-icon {
    transform: translateX(4px);
  }

  /* Email Box */
  .email-box {
    margin: 2.5rem auto 0;
    max-width: 520px;
    background: var(--bg-card);
    border: 1px solid var(--border);
    padding: 1.5rem;
    display: none;
  }

  .email-box.visible { display: grid; gap: 0.75rem; }

  .email-box label {
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: 0.6875rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--muted);
  }

  .email-box input {
    padding: 0.75rem;
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--fg);
    font-family: 'Inter', system-ui, sans-serif;
    font-size: 0.9375rem;
    outline: none;
    transition: border-color 0.2s;
  }

  .email-box input:focus {
    border-color: var(--primary);
  }

  .continue-btn {
    margin-top: 0.25rem;
    padding: 0.75rem;
    border: 1px solid var(--primary);
    background: var(--primary);
    color: var(--primary-fg);
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: 0.8125rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    cursor: pointer;
    transition: box-shadow 0.2s, transform 0.1s;
  }

  .continue-btn:hover {
    box-shadow: 0 0 20px -5px hsla(180, 70%, 55%, 0.4);
    transform: translateY(-1px);
  }

  .continue-btn:disabled {
    opacity: 0.6;
    cursor: wait;
    transform: none;
    box-shadow: none;
  }

  .hint {
    font-size: 0.75rem;
    color: var(--muted);
    line-height: 1.5;
  }

  /* Footer */
  footer {
    position: relative;
    z-index: 1;
    border-top: 1px solid var(--border);
    padding: 2rem;
    text-align: center;
  }

  footer p {
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: 0.6875rem;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    color: var(--muted);
  }

  /* --- Provision overlay (Free plan) --- */
  .hidden { display: none !important; }

  .overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background:
      radial-gradient(circle at 20% 10%, hsla(180,70%,55%,0.12), transparent 45%),
      radial-gradient(circle at 80% 20%, hsla(200,80%,60%,0.10), transparent 45%),
      hsla(220, 20%, 4%, 0.86);
    backdrop-filter: blur(16px);
    display: grid;
    place-items: center;
    padding: 20px;
  }

  .overlay-card {
    width: min(860px, 100%);
    border: 1px solid hsla(220, 14%, 20%, 0.9);
    background: hsla(220, 18%, 7%, 0.92);
    box-shadow: 0 0 60px -18px hsla(180, 70%, 55%, 0.18);
    padding: 18px;
  }

  .overlay-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border);
  }

  .overlay-title {
    font-family: 'Space Grotesk', system-ui, sans-serif;
    font-size: 0.95rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.16em;
    color: var(--fg);
    display: inline-flex;
    align-items: center;
    gap: 10px;
  }

  .pulse {
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: var(--primary);
    box-shadow: 0 0 18px hsla(180, 70%, 55%, 0.45);
    animation: pulse 1.1s ease-in-out infinite;
  }

  @keyframes pulse {
    0% { transform: scale(1); opacity: 0.75; }
    50% { transform: scale(1.5); opacity: 1; }
    100% { transform: scale(1); opacity: 0.75; }
  }

  .terminal {
    margin-top: 14px;
    border: 1px solid var(--border);
    background: hsl(220, 22%, 3%);
    padding: 14px;
    min-height: 220px;
    display: grid;
    gap: 10px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    color: hsl(0, 0%, 92%);
  }

  .term-line {
    display: flex;
    gap: 10px;
    align-items: flex-start;
    opacity: 0;
    transform: translateY(6px);
    animation: lineIn .35s ease forwards;
  }

  @keyframes lineIn {
    to { opacity: 1; transform: translateY(0); }
  }

  .term-bullet {
    color: hsla(180, 70%, 55%, 0.9);
    margin-top: 1px;
  }

  .term-text {
    font-size: 13.5px;
    line-height: 1.45;
  }

  .term-muted {
    color: hsla(220, 10%, 70%, 0.85);
  }

  .progress {
    height: 10px;
    border: 1px solid var(--border);
    background: hsla(220, 15%, 10%, 0.8);
    overflow: hidden;
    margin-top: 12px;
  }

  .progress > div {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, hsla(180,70%,55%,0.9), hsla(200,80%,60%,0.9));
    box-shadow: 0 0 22px -6px hsla(180,70%,55%,0.35);
    transition: width .35s ease;
  }

  .overlay-foot {
    margin-top: 12px;
    display: flex;
    justify-content: space-between;
    gap: 12px;
    color: var(--muted);
    font-size: 0.75rem;
    border-top: 1px solid var(--border);
    padding-top: 12px;
  }

  .overlay-foot strong {
    color: var(--fg);
    font-weight: 600;
  }

  .overlay-error {
    margin-top: 10px;
    color: var(--warn);
    font-size: 0.8rem;
    line-height: 1.4;
    display: none;
  }

  @media (max-width: 768px) {
    header { padding: 0 1rem; }
    .container { padding: 100px 1rem 60px; }
    .nav-links { gap: 1rem; }
    .nav-links a { font-size: 0.6rem; letter-spacing: 0.1em; }
    .pricing-grid { grid-template-columns: 1fr; }
    .subtitle { margin-bottom: 2rem; }
  }

  @media (max-width: 400px) {
    header { padding: 0 0.75rem; height: 56px; }
    .logo { font-size: 1rem; }
    .nav-links { gap: 0.5rem; }
    .nav-links a { font-size: 0.5rem; letter-spacing: 0.06em; }
    .container { padding: 80px 0.75rem 40px; }
    .card { padding: 1.25rem; }
    .price { font-size: 2rem; }
    .email-box { padding: 1rem; }
    h1 { font-size: 1.5rem; }
  }
</style>
</head>
<body>

<div class="grid-bg"></div>

<header>
  <a href="https://xcommand.cloud" class="logo" style="text-decoration:none;">xCommand<span>.</span></a>
  <nav class="nav-links">
    <a href="https://xcommand.cloud/">Home</a>
    <a href="https://xcommand.cloud/pay.html" class="active">Plans</a>
    <a href="https://xcommand.cloud/ready.html">Workspace</a>
    <a href="https://app.xcommand.cloud/support">Support</a>
  </nav>
</header>

<div class="container">
  <p class="section-label">Pricing</p>
  <h1>Choose Your Workspace Plan</h1>
  <p class="subtitle">No setup. No maintenance. Your isolated n8n workspace launches instantly.</p>

  <div class="pricing-grid">
    <!-- Free -->
    <div class="card popular" data-plan="free">
      <div class="card-header">
        <span class="card-title">Free</span>
        <span class="badge free">Try it</span>
      </div>
      <div style="margin-bottom: 0.25rem;">
        <span class="price">$0</span>
        <span class="price-meta">per workspace</span>
      </div>
      <p class="duration">24 hours access</p>
      <p class="desc">Instant sandbox for trying xCommand. Same workflow UI. Auto-expires after 24 hours.</p>
      <ul class="features">
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Dedicated n8n workspace
        </li>
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Full n8n UI
        </li>
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Zero setup required
        </li>
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Auto-expiry after 24 hours
        </li>
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          One click to start
        </li>
      </ul>
      <button class="select-btn">
        Select plan
        <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
      </button>
    </div>

    <!-- Explorer (Coming soon) -->
    <div class="card" data-plan="1d" data-disabled="true">
      <div class="card-header">
        <span class="card-title">Explorer</span>
        <span class="badge soon">Coming soon</span>
      </div>
      <div style="margin-bottom: 0.25rem;">
        <span class="price">$1</span>
        <span class="price-meta">per workspace</span>
      </div>
      <p class="duration">24 hours access</p>
      <p class="desc">Perfect for quick experiments, testing a single integration, or evaluating n8n.</p>
      <ul class="features">
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Dedicated n8n workspace
        </li>
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Full n8n UI
        </li>
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Zero setup required
        </li>
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Auto-expiry after 24 hours
        </li>
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Secure isolated container
        </li>
      </ul>
      <button class="select-btn" disabled>
        Select plan
        <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
      </button>
    </div>

    <!-- Builder (Coming soon) -->
    <div class="card" data-plan="5d" data-disabled="true">
      <div class="card-header">
        <span class="card-title">Builder</span>
        <span class="badge soon">Coming soon</span>
      </div>
      <div style="margin-bottom: 0.25rem;">
        <span class="price">$3</span>
        <span class="price-meta">per workspace</span>
      </div>
      <p class="duration">5 days access</p>
      <p class="desc">For serious prototyping, multi-step workflows, and team evaluation sprints.</p>
      <ul class="features">
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Dedicated n8n workspace
        </li>
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Full n8n UI
        </li>
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Zero setup required
        </li>
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Auto-expiry after 5 days
        </li>
        <li>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
          Perfect for multi-day builds
        </li>
      </ul>
      <button class="select-btn" disabled>
        Select plan
        <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
      </button>
    </div>
  </div>

  <!-- Email box (hidden until plan selected) -->
  <div class="email-box" id="email-box">
    <label for="email-input">Your email for this workspace</label>
    <input id="email-input" type="email" placeholder="you@example.com" required>
    <button class="continue-btn" id="continue-btn">Continue</button>
    <p class="hint" id="hint-text">We’ll use this email to provision and look up your workspace.</p>
  </div>
</div>

<footer>
  <p>&copy; 2026 xCommand Cloud. All rights reserved.</p>
</footer>

<!-- Provision overlay -->
<div class="overlay hidden" id="provision-overlay" aria-hidden="true">
  <div class="overlay-card">
    <div class="overlay-top">
      <div class="overlay-title"><span class="pulse"></span>Provisioning workspace</div>
      <div style="color: var(--muted); font-size: 0.75rem;">A few seconds</div>
    </div>

    <div class="terminal" id="term"></div>

    <div class="progress" aria-label="progress">
      <div id="progress-bar"></div>
    </div>

    <div class="overlay-foot">
      <div>Plan: <strong id="overlay-plan">Free</strong></div>
      <div>Email: <strong id="overlay-email">-</strong></div>
    </div>

    <div class="overlay-error" id="overlay-error">
      Provisioning failed. Please try again.
    </div>
  </div>
</div>

<script>
const API_BASE = "https://api.app.xcommand.cloud";
const CHECKOUT_ENDPOINT = "/stripe/create-checkout-session";
const FREE_PROVISION_ENDPOINT = "/provision/free";

const cards = document.querySelectorAll(".card");
const emailBox = document.getElementById("email-box");
const emailInput = document.getElementById("email-input");
const continueBtn = document.getElementById("continue-btn");
const hintText = document.getElementById("hint-text");

const overlay = document.getElementById("provision-overlay");
const term = document.getElementById("term");
const progressBar = document.getElementById("progress-bar");
const overlayPlan = document.getElementById("overlay-plan");
const overlayEmail = document.getElementById("overlay-email");
const overlayError = document.getElementById("overlay-error");

let selectedPlan = null;

function isFree(plan) { return plan === "free"; }

function setContinueText() {
  if (isFree(selectedPlan)) {
    continueBtn.textContent = "Start Free Workspace";
    hintText.textContent = "We’ll create your workspace now and redirect you to the ready page.";
  } else {
    continueBtn.textContent = "Continue to checkout";
    hintText.textContent = "We’ll use this email to provision and look up your workspace. Stripe will also ask for an email for the receipt.";
  }
}

function setContinueLoading(isLoading) {
  continueBtn.disabled = isLoading;
  if (!selectedPlan) {
    continueBtn.textContent = "Continue";
    return;
  }
  if (isLoading) {
    continueBtn.textContent = isFree(selectedPlan) ? "Provisioning…" : "Creating secure checkout…";
  } else {
    setContinueText();
  }
}

function showOverlay(plan, email) {
  overlayPlan.textContent = isFree(plan) ? "Free" : plan;
  overlayEmail.textContent = email;
  overlayError.style.display = "none";
  term.innerHTML = "";
  progressBar.style.width = "0%";
  overlay.classList.remove("hidden");
  overlay.setAttribute("aria-hidden", "false");
  document.body.style.overflow = "hidden";
}

function addTermLine(text, muted=false) {
  const line = document.createElement("div");
  line.className = "term-line";
  const bullet = document.createElement("div");
  bullet.className = "term-bullet";
  bullet.textContent = ">";
  const t = document.createElement("div");
  t.className = "term-text" + (muted ? " term-muted" : "");
  t.textContent = text;
  line.appendChild(bullet);
  line.appendChild(t);
  term.appendChild(line);

  const idx = term.querySelectorAll(".term-line").length;
  line.style.animationDelay = `${Math.min(0.9, idx * 0.08)}s`;
}

async function runFreeProvision(plan, email) {
  showOverlay(plan, email);

  const steps = [
    { pct: 14, text: "Allocating isolated workspace slot…" },
    { pct: 30, text: "Pulling n8n image…", muted: true },
    { pct: 46, text: "Creating Docker volume…" },
    { pct: 62, text: "Starting container + routing…" },
    { pct: 78, text: "Applying encryption + health checks…", muted: true },
    { pct: 92, text: "Finalizing workspace URL…" },
  ];

  for (const s of steps) {
    addTermLine(s.text, !!s.muted);
    progressBar.style.width = `${s.pct}%`;
    await new Promise(r => setTimeout(r, 520));
  }

  try {
    const res = await fetch(API_BASE + FREE_PROVISION_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })
    });

    if (!res.ok) {
      const txt = await res.text();
      throw new Error(txt || "Provision API error");
    }

    const data = await res.json();
    addTermLine(data.reused ? "Workspace found. Reusing existing instance." : "Workspace created successfully.");
    progressBar.style.width = "100%";
    await new Promise(r => setTimeout(r, 650));

    window.location.href = `${window.location.origin}/ready.html`;
  } catch (err) {
    console.error(err);
    overlayError.style.display = "block";
    addTermLine("Provisioning failed. Please try again.", true);
    progressBar.style.width = "100%";
    setContinueLoading(false);
    document.body.style.overflow = "";
  }
}

cards.forEach(card => {
  const btn = card.querySelector(".select-btn");
  const disabled = card.getAttribute("data-disabled") === "true";
  if (disabled) return;

  btn.addEventListener("click", () => {
    document.querySelectorAll(".select-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    selectedPlan = card.dataset.plan;

    emailBox.classList.add("visible");
    setContinueText();

    emailBox.scrollIntoView({ behavior: "smooth", block: "center" });
    setTimeout(() => emailInput.focus(), 400);
  });
});

continueBtn.addEventListener("click", async () => {
  if (!selectedPlan) { alert("Please select a plan first."); return; }

  const email = emailInput.value.trim();
  if (!email) { alert("Please enter your email."); emailInput.focus(); return; }

  try {
    localStorage.setItem("x_email", email);
    localStorage.setItem("x_plan", selectedPlan);
  } catch (e) { console.warn("localStorage not available", e); }

  if (isFree(selectedPlan)) {
    setContinueLoading(true);
    await runFreeProvision(selectedPlan, email);
    return;
  }

  // Paid: Stripe flow (kept intact)
  const successUrl = window.location.origin + "/ready.html";
  const cancelUrl = window.location.href;

  setContinueLoading(true);

  try {
    const res = await fetch(API_BASE + CHECKOUT_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, plan: selectedPlan, success_url: successUrl, cancel_url: cancelUrl })
    });
    if (!res.ok) { const txt = await res.text(); throw new Error(txt || "Checkout API error"); }
    const data = await res.json();
    if (data.checkout_url) { window.location.href = data.checkout_url; }
    else if (data.id) { alert("Backend returned a session id but checkout_url is missing."); setContinueLoading(false); }
    else { throw new Error("Unexpected response from checkout endpoint."); }
  } catch (err) {
    console.error(err);
    alert("Could not start checkout. Please try again.");
    setContinueLoading(false);
  }
});
</script>
</body>
</html>